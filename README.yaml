name: "aws-snowflake-account"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-snowflake-account"
# Short description of this project
description: |-
  This component sets up the requirements for all other Snowflake components, including creating the Terraform service
  user. Before running this component, follow the manual, Click-Ops steps below to create a Snowflake subscription.

  ## Deployment Steps

  1. Open the AWS Console for the given stack.
  2. Go to AWS Marketplace Subscriptions.
  3. Click "Manage Subscriptions", click "Discover products", type "Snowflake" in the search bar.
  4. Select "Snowflake Data Cloud"
  5. Click "Continue to Subscribe"

  6. Fill out the information steps using the following as an example. Note, the provided email cannot use labels such as
    `mdev+sbx01@example.com`.

  ```
    First Name: John
    Last Name: Smith
    Email: aws@example.com
    Company: Example
    Country: United States
  ```

  7. Select "Standard" and the current region. In this example, we chose "US East (Ohio)" which is the same as
    `us-east-1`.
  8. Continue and wait for Sign Up to complete. Note the Snowflake account ID; you can find this in the newly accessible
    Snowflake console in the top right of the window.
  9. Check for the Account Activation email. Note, this may be collected in a Slack notifications channel for easy access.
  10. Follow the given link to create the Admin user with username `admin` and a strong password. Be sure to save that
      password somewhere secure.
  11. Upload that password to AWS Parameter Store under `/snowflake/$ACCOUNT/users/admin/password`, where `ACCOUNT` is the
      value given during the subscription process. This password will only be used to create a private key, and all other
      authentication will be done with said key. Below is an example of how to do that with a
      [chamber](https://github.com/segmentio/chamber) command:

  ```
  AWS_PROFILE=$NAMESPACE-$TENANT-gbl-sbx01-admin chamber write /snowflake/$ACCOUNT/users/admin/ admin $PASSWORD
  ```

  11. Finally, use atmos to deploy this component:

  ```
  atmos terraform deploy snowflake/account --stack $TENANT-use2-sbx01
  ```

  ## Migrate `chanzuckerberg/snowflake` to `snowflakedb/snowflake` provider
  5/25/2022 the provider has been transferred from the Chan Zuckerberg Initiative (CZI) GitHub organization to snowflakedb org.
  To upgrade from CZI, please run the following command:
  ```shell
  terraform state replace-provider chanzuckerberg/snowflake snowflakedb/snowflake
  ```
usage: |-
  **Stack Level**: Regional

  Here's an example snippet for how to use this component:

  ```yaml
  components:
    terraform:
      snowflake-account:
        settings:
          spacelift:
            workspace_enabled: false
        vars:
          enabled: true
          snowflake_account: "AB12345"
          snowflake_account_region: "us-east-2"
          snowflake_user_email_format: "aws.dev+%s@example.com"
          tags:
            Team: data
            Service: snowflake
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->
references:
  - name: chamber
    url: https://github.com/segmentio/chamber
    description: ""
tags:
  - component/snowflake-account
  - layer/unassigned
  - provider/aws
  - provider/snowflake
# Categories of this project
categories:
  - component/snowflake-account
  - layer/unassigned
  - provider/aws
  - provider/snowflake
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-snowflake-account.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-snowflake-account/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
